#!/usr/bin/env python
# -*- encoding: utf-8 -*-
# Michel Mooij, michel.mooij7@gmail.com


import os
import waftools
from waftools import ccross


top = '.'
out = 'build'
prefix = 'output'
ccrossini = os.path.abspath('ccross.ini').replace('\\', '/')


VERSION = waftools.version
APPNAME = 'waftools-test'


def options(opt):
	opt.add_option('--prefix', dest='prefix', default=prefix, help='installation prefix [default: %r]' % prefix)
	print(waftools.location)
	opt.load('ccross', tooldir=waftools.location)


def configure(conf):
	conf.env.CCROSSINI = ccrossini
	conf.load('ccross')


def build(bld):
	ccross.build(bld, trees=['components'])


def dist(ctx):
	ctx.algo = 'tar.gz'
	ctx.excl = ' **/*~ **/.lock-w* **/CVS/** **/.svn/** downloads/** ext/** build/** tmp/**'


# create commands for cross-compile environments
for var in ccross.variants(ccrossini):
	for ctx in ccross.contexts():
		name = ctx.__name__.replace('Context','').lower()
		class _t(ctx):
			__doc__ = "%ss '%s'" % (name, var)
			cmd = name + '_' + var
			variant = var


